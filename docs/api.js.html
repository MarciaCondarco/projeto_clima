<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: api.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: api.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>const form = document.getElementById('form-clima');
const resultado = document.getElementById('resultado');

/**
 * @async 
 *
 * @param {Event} e Evento de submiss√£o do formul√°rio
 * /
 * / Adiciona um listener para o evento de submiss√£o do formul√°rio
 * /
 *  
 * / @return {Promise&lt;void>}
 */

form.addEventListener('submit', async (e) => {
e.preventDefault();

    const cidade = document.getElementById('cidade').value.trim();

    if (!cidade) return alert('Digite o nome de uma cidade.');

    try {
        const urlGeo = `https://geocoding-api.open-meteo.com/v1/search?name=${encodeURIComponent(cidade)}&amp;count=1&amp;language=pt&amp;format=json`;
        const respostaGeo = await fetch(urlGeo);
        const dadosGeo = await respostaGeo.json();
    

    if (!dadosGeo.results || dadosGeo.results.length === 0) {
    alert('Cidade n√£o encontrada!');
    return;
    }



    const cidadeInfo = dadosGeo.results[0];
    const latitude = cidadeInfo.latitude;
    const longitude = cidadeInfo.longitude;
    const nomeFormatado = `${cidadeInfo.name}, ${cidadeInfo.country}`;

    const urlClima = `https://api.open-meteo.com/v1/forecast?latitude=${latitude}&amp;longitude=${longitude}&amp;current_weather=true`;
    const respostaClima = await fetch(urlClima);
    const dadosClima = await respostaClima.json();
    const clima = dadosClima.current_weather;
    const descricaoClima = descreverClima(clima.weathercode);

    document.getElementById('nomeCidade').textContent = nomeFormatado;
    document.getElementById('temperatura').textContent = `üå°Ô∏è Temperatura: ${clima.temperature}¬∞C`;
    document.getElementById('descricao').textContent = `üå•Ô∏è Clima: ${descricaoClima}`;


    resultado.style.display = 'block';

    /**filtrar apenas por cidades no Brasil
     * * @type {Object|null}
     * @property {string} country_code C√≥digo do pa√≠s (ex: "BR" para Brasil)
     * @property {string} name Nome da cidade
     * @property {number} latitude Latitude da cidade
     * @property {number} longitude Longitude da cidade
     * @property {string} timezone Fuso hor√°rio da cidade
     * @property {string} admin1 Admin1 (estado/prov√≠ncia) da cidade    
     * 
    */
    const cidadeBrasil = dadosGeo.results.find((item)=> item.country_code === "BR");
    if(!cidadeBrasil){
        nomeCidade.textContent="";
        temperatura.textContent="";
        descricao.textContent="";
        document.getElementById('validacao').textContent = `‚ùå Por Enquanto, o sistema s√≥ funciona para cidades do Brasil`;
    }
        // üëâ chama aqui, passando o weathercode certo
    atualizarFundo(clima.weathercode);

        // icones
    const iconeClasse = obterIconeClima(clima.weathercode);
    const iconeElemento = document.getElementById('iconeClima');
    iconeElemento.className = `wi ${iconeClasse}`;



} catch (url) {
    fetchComErro(url);
    console.error('Erro ao consultar API:', url);
    document.alert('Erro ao buscar os dados clim√°ticos.');
}
});

/**@async 
 * @param {string} url
 * @return {Promise&lt;Response>} resposta da fetch
 */

async function fetchComErro(url) {
    try{
        const resposta = await fetch(url);
        if(!resposta.ok){
            throw new Error (`Erro na API (${resposta.status}): $(resposta.statusText)`);
        }
        return resposta;
    }catch (e){
        if (e.name === "TypeError"){
            throw new Error("Erro na rede. Verifique a sua conex√£o com a internet");
        }
        throw e;
    }
}

/**
 * @function atualizarFundo Atualiza o fundo da p√°gina com base no c√≥digo do clima
 * @param {number} weatherCode C√≥digo do clima conforme a API Open-Meteo
 */

function atualizarFundo(weatherCode) {
const body = document.body;

    let background;

    if (weatherCode === 0) {
        background = "linear-gradient(to bottom, #87CEFA, #fefefe)"; // c√©u limpo
    } else if (weatherCode >= 1 &amp;&amp; weatherCode &lt;= 3) {
        background = "linear-gradient(to bottom, #a4b0be, #dfe4ea)"; // nublado
    } else if (weatherCode >= 45 &amp;&amp; weatherCode &lt;= 48) {
        background = "linear-gradient(to bottom, #636e72, #b2bec3)"; // neblina
    } else if (weatherCode >= 51 &amp;&amp; weatherCode &lt;= 67) {
        background = "linear-gradient(to bottom, #74b9ff, #a29bfe)"; // garoa
    } else if (weatherCode >= 80 &amp;&amp; weatherCode &lt;= 82) {
        background = "linear-gradient(to bottom, #2c3e50, #4ca1af)"; // chuva
    } else if (weatherCode >= 95 &amp;&amp; weatherCode &lt;= 99) {
        background = "linear-gradient(to bottom, #000000, #434343)"; // tempestade
    } else {
        background = "linear-gradient(to bottom, #bdc3c7, #2c3e50)"; // padr√£o
    }

    body.style.background = background;
    body.style.transition = "background 1s ease";
}


//Traduz o c√≥digo do tempo do Open-Meteo para uma descri√ß√£o em portugu√™s.


function descreverClima(codigo) {
    const mapa = {
    0: "C√©u limpo",
    1: "Principalmente limpo",
    2: "Parcialmente nublado",
    3: "Nublado",
    45: "Nevoeiro",
    48: "Nevoeiro com gelo",
    51: "Garoa fraca",
    53: "Garoa moderada",
    55: "Garoa intensa",
    61: "Chuva fraca",
    63: "Chuva moderada",
    65: "Chuva forte",
    71: "Neve fraca",
    73: "Neve moderada",
    75: "Neve forte",
    80: "Aguaceiros fracos",
    81: "Aguaceiros moderados",
    82: "Aguaceiros fortes",
    95: "Tempestade",
    96: "Tempestade com granizo leve",
    99: "Tempestade com granizo forte"
    };

    return mapa[codigo] || "Condi√ß√£o desconhecida";
}

/** 
 * @function obterIconeClima Mapeia o c√≥digo do clima para a classe de √≠cone correspondente
 * @param {number} codigo C√≥digo do clima conforme a API Open-Meteo
 * @return {string} Classe do √≠cone correspondente
*/


function obterIconeClima(codigo) {
    const mapaIcones = {
        0: "wi-day-sunny",
        1: "wi-day-sunny-overcast",
        2: "wi-day-cloudy",
        3: "wi-cloudy",
        45: "wi-fog",
        48: "wi-fog",
        51: "wi-sprinkle",
        53: "wi-showers",
        55: "wi-rain",
        61: "wi-rain",
        63: "wi-rain",
        65: "wi-rain",
        71: "wi-snow",
        73: "wi-snow",
        75: "wi-snow",
        80: "wi-showers",
        81: "wi-showers",
        82: "wi-showers",
        95: "wi-thunderstorm",
        96: "wi-storm-showers",
        99: "wi-storm-showers"
    };
    return mapaIcones[codigo] || "wi-na";
}
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Global</h3><ul><li><a href="global.html#atualizarFundoAtualizaofundodap%25C3%25A1ginacombasenoc%25C3%25B3digodoclima">atualizarFundo Atualiza o fundo da p√°gina com base no c√≥digo do clima</a></li><li><a href="global.html#fetchComErro">fetchComErro</a></li><li><a href="global.html#obterIconeClimaMapeiaoc%25C3%25B3digodoclimaparaaclassede%25C3%25ADconecorrespondente">obterIconeClima Mapeia o c√≥digo do clima para a classe de √≠cone correspondente</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 4.0.5</a> on Mon Nov 10 2025 22:46:02 GMT-0300 (Hor√°rio Padr√£o de Bras√≠lia)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
